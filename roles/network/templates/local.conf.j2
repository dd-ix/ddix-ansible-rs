{{ ansible_managed|comment }}

# Stop low-level messages on console
kernel.printk = 4 4 1 7

# Enable RFC1337 stuff
net.ipv4.tcp_rfc1337 = 1

# Send keep alive after 10min of inactivity
net.ipv4.tcp_keepalive_time = 600

# Probe every 33sec (up to 9 times, so we get 15min timeout in total)
net.ipv4.tcp_keepalive_intvl = 33

# Protect bottom 64k of memory from mmap to prevent NULL-dereference
# attacks against potential future kernel security vulnerabilities.
# (Added in kernel 2.6.23.)
vm.mmap_min_addr = 65536

# This machine should not participate in SLAAC
net.ipv6.conf.default.autoconf = 0
net.ipv6.conf.all.autoconf = 0

# Nor accept router advertisments
net.ipv6.conf.default.accept_ra = 0
net.ipv6.conf.all.accept_ra = 0

# No redirects an no evil RH0
net.ipv6.conf.all.accept_redirects = 0
net.ipv6.conf.default.accept_redirects = 0
net.ipv6.conf.default.accept_source_route = 0
net.ipv6.conf.all.accept_source_route = 0

# Increase IPv6 route table limits (defaults to 4096)
net.ipv6.route.max_size = 2147483647

# Enable forwarding
net.ipv4.ip_forward = 1
net.ipv6.conf.default.forwarding = 1
net.ipv6.conf.all.forwarding = 1

# No redirects
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.default.accept_redirects = 0
net.ipv4.conf.all.send_redirects = 0
net.ipv4.conf.default.send_redirects = 0
net.ipv4.conf.all.accept_source_route = 0
net.ipv4.conf.default.accept_source_route = 0

# Default VRF binding
net.ipv4.raw_l3mdev_accept = 1
net.ipv4.tcp_l3mdev_accept = 1
net.ipv4.udp_l3mdev_accept = 1

# ARP
net.ipv4.conf.all.arp_ignore = 1
net.ipv4.conf.default.arp_ignore = 1
net.ipv4.conf.all.arp_notify = 1
net.ipv4.conf.default.arp_notify = 1

# Change RP filtering to strict
net.ipv4.conf.default.rp_filter = 1
net.ipv4.conf.all.rp_filter = 1

# Bufferbloat: fair queuing controlled delay
net.core.default_qdisc = cake

# Tune SoftIRQ packet handling (5x)
net.core.netdev_budget_usecs=10000
net.core.netdev_budget=1500
net.core.dev_weight = 320
net.core.netdev_max_backlog = 5000

# ICMP errors from iface addresses (traceroute)
net.ipv4.icmp_errors_use_inbound_ifaddr = 1

# Behave like a router, ignore routes via interfaces in linkdown
net.ipv4.conf.all.ignore_routes_with_linkdown = 1
net.ipv4.conf.default.ignore_routes_with_linkdown = 1
net.ipv6.conf.all.ignore_routes_with_linkdown = 1
net.ipv6.conf.default.ignore_routes_with_linkdown = 1

# Increase receive buffer (for netlink messages)
net.core.rmem_default = 31457280
net.core.rmem_max = 33554432
